<!DOCTYPE html>

{% load static %}
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv = "Cache-Control" content = "no-cache">
    <meta http-equiv = "X-UA-Compatible" content = "IE=edge">
    <meta name="description" content="">
    <meta name="author" content="">

    <script src="{% static 'board/vendor/jquery/jquery.js' %}"></script>
    <script src="{% static 'board/vendor/bootstrap/css/bootstrap.css' %}"></script>
    <script src="https://cdn.rawgit.com/ethereum/web3.js/develop/dist/web3.js"></script>

    <script src="{% static 'board/vendor/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'board/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <link href="{% static 'board/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <title>uni:d</title>

    <!--favicon -->
    <link rel="shortcut icon" href="{% static 'board/icon/unid_favicon.ico' %}">
    <!-- Bootstrap core CSS -->

    <!-- Custom styles for this template -->
    <link href="{% static 'board/css/shop-homepage.css' %}" rel="stylesheet">
    <link href="{% static 'board/css/mywallet.css' %}" rel="stylesheet">
    <!-- 검색아이콘 -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 구글 notosan-font -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:300,400,500,700&amp;subset=korean" rel="stylesheet">
    <!--wallet function-->
    <!--<link rel="stylesheet" href="{% static 'unid/node_modules/bootstrap/dist/css/bootstrap.css' %}">-->
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    <script src="{% static 'board/node_modules/jquery/dist/jquery.js' %}"></script>
    <!--<script src="{% static 'unid/node_modules/bootstrap/dist/js/bootstrap.js' %}"></script>-->

</head>

<body>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="http://localhost:8000/unid">
            <img src="{% static 'board/icon/unid_icon.png' %}" border="0" width="113" height="54">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="box">
             <div class="container-1">
                 <div class="icon-box">
                    <span class="icon"><i class="fa fa-search"></i></span>
                 </div>
                 <div class="text-box">
                    <input type="search" id="search" placeholder="Search..." />
                 </div>
              </div>
        </div>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">정보공유
                    </a>
                </li>
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                <li class="nav-item">
                    <a class="nav-link" href="#">컨텐츠거래</a>
                </li>
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                <li class="nav-item">
                    <a class="nav-link" href="#">크라우드펀딩</a>
                </li>
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">
                        <img src="{% static 'board/icon/profle-icon.png' %}" border="0" width="32" height="32">
                    </a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="http://localhost:8000/unid/login">로그인</a>
                        <a class="dropdown-item" href="http://localhost:8000/unid/signup">회원가입</a>
                        <a class="dropdown-item" href="#">마이페이지</a>
                        <a class="dropdown-item" href="#">게시글작성</a>
                        <a class="dropdown-item" href="/unid/contentsUpload.html">컨텐츠등록</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>
{% block content %}

<!-- Page Content -->
<div class="container1">
    <!-- contents InFo -->
    <div class="rows">
        <div class="row">
            <div class="contents-info">
                    <h5 class="contents-title">
                        <b>  내 지갑 </b>
                    </h5>

                    <h4 class="contents-title2" align="right">
                        <img src="{% static 'board/icon/key.png' %}" border="0" width="25" height="25">
                        <img src="{% static 'board/icon/line-graph.png' %}" border="0" width="25" height="25">
                    </h4>
                </br>
                </br>
                <hr size="10" align="center" width=100% noshade="noshade" color="#efefef"  />
                    <div id="Status_account">
                    {% if request.session.user_name %}
                    <p align="center" size ="5"> {{ request.session.user_name }} 님의 보유자산 </p>
                    {% endif %}
                    </div>
                <p align="center" size ="100"><img src="{% static 'board/icon/wallet.png' %}" border="0" width="230" height="230">  </p>
                    <div id="Status_balance">
                    </div>
                </br>
                </br>
                <div class="function-button">
                        <a href="http://127.0.0.1:8000/unid/transaction/"> <img src="{% static 'board/icon/credit-card.png' %}" border="0" width="100" height="100"></a>
                    <br>
                        <span class="icon-name" size="5">전송</span>
                </div>
                <div class="function-button">
                        <img src="{% static 'board/icon/exchange.png' %}" border="0" width="100" height="100">
                    <br>
                        <span class="icon-name" size="5">환전</span>
                </div>
                <div class="function-button">
                        <img src="{% static 'board/icon/bill.png' %}" border="0" width="100" height="100">
                    <br>
                        <span class="icon-name"  size="5">구매</span>
                </div>

            </div>
        </div>

        </br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br></br>


        <!-- search bar -->
        <div class="box">
             <div class="container-2">
                 <div class="icon-box">
                    <span class="icon"><i class="fa fa-search"></i></span>
                 </div>
                 <div class="text-box">
                    <input type="search" id="search" placeholder="Search..." />
                 </div>
              </div>
        </div>
        <!-- history -->
        <div class="row">
            <div class="history">
                <div>
                    <span>보상내역</span>
                    <span>6건</span>
                </div>
                <div>
                    <div class="history-total">
                    <div>
                        <span>total</span> <span>10.4nid</span>
                    </div>
                    <div>
                        <span>(+3.4)</span>
                    </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- history-detail -->
        <div class="row">
            <div class="history-detail">
                2018.11.20   &nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/warning.png' %}" border="0" width="20" height="20">
                3.4nid
                <span class="history-name" > 한양대 교양중 제일 재미있는 교양 추천의 보상</span>
            </div>
        </div>
        <div class="row">
            <div class="history-detail">
                2018.11.20   &nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/warning.png' %}" border="0" width="20" height="20">
                3.4nid
                <span class="history-name" > 한양대 교양중 제일 재미있는 교양 추천의 보상</span>
            </div>
        </div>
        <div class="row">
            <div class="history-detail">
                2018.11.20   &nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/success.png' %}" border="0" width="20" height="20">
                3.4nid
                <span class="history-name" > 한양대 교양중 제일 재미있는 교양 추천의 보상</span>
            </div>
        </div>
        <div class="row">
            <div class="history-detail">
                2018.11.20   &nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/success.png' %}" border="0" width="20" height="20">
                3.4nid
                <span class="history-name" > 한양대 교양중 제일 재미있는 교양 추천의 보상</span>
            </div>
        </div>
        </br>
        </br>
        <!-- history -->
        <div class="row">
            <div class="history">
                <div>
                    <span>거래내역</span>
                    <span>6건</span>
                </div>
            </div>
        </div>

        <!-- history-detail -->
        <div class="row">
            <div class="history-detail">
                2018.11.20 &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/user.png' %}" border="0" width="18" height="18">
                <span> gorapapa </span> &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/user.png' %}" border="0" width="18" height="18">
                <span> kingsori </span> &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/dollar.png' %}" border="0" width="18" height="18">
                <span> 32nid </span>
                <span class="history-name" > 0x3i4kl4hi3oief56i4h4oi</span>
            </div>
        </div>
        <div class="row">
            <div class="history-detail">
                2018.11.20 &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/user.png' %}" border="0" width="18" height="18">
                <span> gorapapa </span> &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/user.png' %}" border="0" width="18" height="18">
                <span> kingsori </span> &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/dollar.png' %}" border="0" width="18" height="18">
                <span> 32nid </span>
                <span class="history-name" > 0x3i4kl4hi3oief56i4h4oi</span>
            </div>
        </div>
        <div class="row">
            <div class="history-detail">
                2018.11.20 &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/user.png' %}" border="0" width="18" height="18">
                <span> gorapapa </span> &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/user.png' %}" border="0" width="18" height="18">
                <span> kingsori </span> &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/dollar.png' %}" border="0" width="18" height="18">
                <span> 32nid </span>
                <span class="history-name" > 0x3i4kl4hi3oief56i4h4oi</span>
            </div>
        </div>
        <div class="row">
            <div class="history-detail">
                2018.11.20 &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/user.png' %}" border="0" width="18" height="18">
                <span> gorapapa </span> &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/user.png' %}" border="0" width="18" height="18">
                <span> kingsori </span> &nbsp&nbsp&nbsp&nbsp
                <img src="{% static 'board/icon/dollar.png' %}" border="0" width="18" height="18">
                <span> 32nid </span>
                <span class="history-name" > 0x3i4kl4hi3oief56i4h4oi</span>
            </div>
        </div>
    </div>

</div>

       <!--<div class="container">-->
           <!--&lt;!&ndash; 제목 &ndash;&gt;-->
           <!--<div class="row">-->
               <!--<h1>ETHER Wallet</h1>-->
           <!--</div>-->
           <!--&lt;!&ndash; 계좌 잔고 출력 &ndash;&gt;-->
           <!--<div class="row">-->
               <!--<div id="divStatus">-->
               <!--</div>-->
           <!--</div>-->
           <!--&lt;!&ndash; 송금 입력 창 &ndash;&gt;-->
           <!--<div class="row">-->
               <!--<div class="input-group">-->
                   <!--<label class="input-group-text" for="fromAccounts">보내는 사람</label>-->
                   <!--<select class="form-control accountsList" id="fromAccounts">-->
                       <!--<option selected>선택하세요.</option>-->
                   <!--</select>-->
               <!--</div>-->
               <!--<div class="input-group">-->
                   <!--<label class="input-group-text" for="fromPassword">패스워드</label>-->
                   <!--<input class="form-control" id="fromPassword" type="password" />-->
               <!--</div>-->
               <!--<div class="input-group">-->
                   <!--<label class="input-group-text" for="toAccounts">받는 사람</label>-->
                   <!--<select class="form-control accountsList" id="toAccounts">-->
                       <!--<option selected>선택하세요.</option>-->
                   <!--</select>-->
               <!--</div>-->
               <!--<div class="input-group">-->
                   <!--<label class="input-group-text" for="amount">송금액</label>-->
                   <!--<input class="form-control" id="amount" type="number" />-->
                   <!--<div class="input-group-append">-->
                       <!--<span class="input-group-text">ETHER</span>-->
                       <!--<button type="button" class="btn btn-primary" id="btnSend">송금</button>-->
                   <!--</div>-->
               <!--</div>-->
           <!--</div>-->
       <!--</div>-->



       <script>
           var WEB3 = require('web3');
           var web3 = new WEB3();
           web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545"));

           var _supply = 10000;
           var _name = "NidCoin";
           var _symbol = "nid";
           var _decimals = 0;
           var NidCoinContract = web3.eth.contract([{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"int256"}],"name":"transfer","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"_supply","type":"int256"},{"name":"_name","type":"string"},{"name":"_symbol","type":"string"},{"name":"_decimals","type":"uint8"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"int256"}],"name":"EvtTransfer","type":"event"}]);

           var nd = NidCoinContract.at( "0xdb5e616615330b3ebefc41d547d109579900ca70" );

           // 계정 정보를 조회해서 보내는 사람과 받는 사람 선택창에 설정
           function setAccountsList() {
               let accounts = web3.eth.accounts;
               accounts.forEach(account => {
                   $('.accountsList').append(`
                       <option value="${account}">
                           ${account.substr(0,6)}...${account.substr(-4)}
                       </option>
                   `);
               });
           }

           // 계정별 잔액을 출력
           function showStatus() {

               <!--let statusAccount = `-->
                    <!--<p id="ac" align="center" size ="5"></p>-->
               <!--`;-->

               let statusBalance =`
                   <h4 align="center" size ="5"> nid </h4>
                   <h4 id="ba" align="center" size ="5"></h4>
                `;

               <!--$('#Status_account').empty();-->
               <!--$('#Status_account').append(statusAccount);-->

               $('#Status_balance').empty();
               $('#Status_balance').append(statusBalance);

               let totalAmount = 0;
               let accounts = web3.eth.accounts;
               let account = accounts[0];
               let balance = parseFloat(web3.fromWei(web3.eth.getBalance(account), "ether"));
               totalAmount += balance;
               <!--$("#ac").append(`${account}의 보유자산`);-->
               $('#ba').append(`${balance}eth`);


           }

           $(function() {
               setAccountsList();
               showStatus();

               // 블록에 변화가 생겼을 때 계정별 잔액 정보를 갱신
               web3.eth.filter('latest').watch(function() {
                   showStatus();
               });

               // 송금 버튼을 클릭했을 때, 송금을 요청
               $('#btnSend').click(function() {
                   let fromAccount  = $('#fromAccounts').val();
                   let toAccount    = $('#toAccounts').val();
                   let fromPassword = $('#fromPassword').val();
                   let amount       = $('#amount').val();

                   // 보내는 사람의 계정을 언락
                   let isUnlock = web3.personal.unlockAccount(fromAccount, fromPassword);
                   if (isUnlock) {
                       web3.eth.sendTransaction({
                           from : fromAccount,
                           to   : toAccount,
                           value: web3.toWei(amount, "ether")
                       }, function(err, res) {
                           if (!err) {
                               console.log(`txid is ${res}.`);
                           } else {
                               console.error(err);
                           }
                       });
                   }
               });
           });
       </script>

{% endblock %}

</body>

</html>
